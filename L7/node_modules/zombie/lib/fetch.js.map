{"version":3,"sources":["fetch.js"],"names":["_","require","HTTP","Stream","URL","Zlib","decompressStream","stream","headers","transferEncoding","get","contentEncoding","pipe","createInflate","createGunzip","Headers","constructor","init","_headers","Array","isArray","name","value","append","each","caseInsensitive","toLowerCase","castValue","String","replace","push","delete","filter","header","namedHeader","find","getAll","map","has","set","replaced","reduce","memo","valueOf","toString","join","toObject","object","FormData","_entries","filename","entry","namedEntry","length","_asStream","boundary","iterator","Readable","_read","next","read","buffer","mime","text","done","Body","bodyInit","_stream","_contentType","PassThrough","pause","Date","getTime","Math","random","TypeError","_bodyUsed","body","bodyUsed","arrayBuffer","_consume","then","Uint8Array","i","blob","Error","formData","contentType","mimeType","split","json","JSON","parse","readable","Buffer","decompressed","resolve","reject","buffers","on","concat","resume","Request","input","method","toUpperCase","url","format","redirect","_redirectCount","clone","Response","responseInit","status","RangeError","statusText","STATUS_CODES","test","_url","type","ok","error","parsedURL","indexOf","response","module","exports"],"mappings":"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","file":"fetch.js","sourcesContent":["const _       = require('lodash');\nconst HTTP    = require('http');\nconst Stream  = require('stream');\nconst URL     = require('url');\nconst Zlib    = require('zlib');\n\n\n// Decompress stream based on content and transfer encoding headers.\nfunction decompressStream(stream, headers) {\n  const transferEncoding  = headers.get('Transfer-Encoding');\n  const contentEncoding   = headers.get('Content-Encoding');\n  if (contentEncoding === 'deflate' || transferEncoding === 'deflate')\n    return stream.pipe( Zlib.createInflate() );\n  if (contentEncoding === 'gzip' || transferEncoding === 'gzip')\n    return stream.pipe( Zlib.createGunzip() );\n  return stream;\n}\n\n\n// https://fetch.spec.whatwg.org/#headers-class\nclass Headers {\n\n  constructor(init) {\n    this._headers = [];\n    if (init instanceof Headers || Array.isArray(init))\n      for (let [name, value] of init)\n        this.append(name, value);\n    else if (typeof init === 'object')\n      _.each(init, (value, name)=> {\n        this.append(name, value);\n      });\n  }\n\n  append(name, value) {\n    const caseInsensitive = name.toLowerCase();\n    const castValue       = String(value).replace(/\\r\\n/g, '');\n    this._headers.push([caseInsensitive, castValue]);\n  }\n\n  delete(name) {\n    const caseInsensitive = name.toLowerCase();\n    this._headers = this._headers.filter(header => header[0] !== caseInsensitive);\n  }\n\n  get(name) {\n    const caseInsensitive = name.toLowerCase();\n    const namedHeader = _.find(this._headers, header => header[0] === caseInsensitive);\n    return namedHeader ? namedHeader[1] : null;\n  }\n\n  getAll(name) {\n    const caseInsensitive = name.toLowerCase();\n    return this._headers\n      .filter(header => header[0] === caseInsensitive)\n      .map(header => header[1]);\n  }\n\n  has(name) {\n    const caseInsensitive = name.toLowerCase();\n    const namedHeader = _.find(this._headers, header => header[0] === caseInsensitive);\n    return !!namedHeader;\n  }\n\n  set(name, value) {\n    const caseInsensitive = name.toLowerCase();\n    const castValue       = String(value).replace(/\\r\\n/g, '');\n    let   replaced        = false;\n    this._headers = this._headers.reduce(function(memo, header) {\n      if (header[0] !== caseInsensitive)\n        memo.push(header);\n      else if (!replaced) {\n        memo.push([header[0], castValue]);\n        replaced = true;\n      }\n      return memo;\n    }, []);\n\n    if (!replaced)\n      this.append(name, value);\n  }\n\n  [Symbol.iterator]() {\n    return this._headers[Symbol.iterator]();\n  }\n\n  valueOf() {\n    return this._headers.map(([name, value])=> `${name}: ${value}`);\n  }\n\n  toString() {\n    return this.valueOf().join('\\n');\n  }\n\n  toObject() {\n    const object = Object.create(null);\n    for (let [name, value] of this._headers)\n      object[name] = value;\n    return object;\n  }\n\n}\n\n\nclass FormData {\n\n  constructor() {\n    this._entries = [];\n  }\n\n  append(name, value /*, filename*/) {\n    // TODO add support for files\n    this._entries.push([name, value]);\n  }\n\n  set(name, value, filename) {\n    this.delete(name);\n    this.append(name, value, filename);\n  }\n\n  delete(name) {\n    this._entries = this._entries.filter(entry => entry[0] !== name);\n  }\n\n  get(name) {\n    const namedEntry = _.find(this._entries, entry => entry[0] === name);\n    return namedEntry ? namedEntry[1] : null;\n  }\n\n  getAll(name) {\n    return this._entries\n      .filter(entry => entry[0] === name)\n      .map(entry => entry[1]);\n  }\n\n  has(name) {\n    const namedEntry = _.find(this._entries, entry => entry[0] === name);\n    return !!namedEntry;\n  }\n\n  [Symbol.iterator]() {\n    return this._entries[Symbol.iterator]();\n  }\n\n  get length() {\n    return this._entries.length;\n  }\n\n  _asStream(boundary) {\n    const iterator  = this._entries[Symbol.iterator]();\n    const stream    = new Stream.Readable();\n    stream._read = function() {\n      const next = iterator.next();\n      if (next.value) {\n        const [name, value] = next.value;\n        this.push(`--${boundary}\\r\\n`);\n        if (value.read) {\n          const buffer = value.read();\n          this.push(`Content-Disposition: form-data; name=\\\"${name}\\\"; filename=\\\"${value}\\\"\\r\\n`);\n          this.push(`Content-Type: ${value.mime || 'application/octet-stream'}\\r\\n`);\n          this.push(`Content-Length: ${buffer.length}\\r\\n`);\n          this.push('\\r\\n');\n          this.push(buffer);\n        } else {\n          const text = value.toString('utf-8');\n          this.push(`Content-Disposition: form-data; name=\\\"${name}\\\"\\r\\n`);\n          this.push('Content-Type: text/plain; charset=utf8\\r\\n');\n          this.push(`Content-Length: ${text.length}\\r\\n`);\n          this.push('\\r\\n');\n          this.push(text);\n        }\n        this.push('\\r\\n');\n      }\n      if (next.done) {\n        this.push(`--${boundary}--`);\n        this.push(null);\n      }\n    };\n    return stream;\n  }\n}\n\n\nclass Body {\n\n  constructor(bodyInit) {\n    if (bodyInit instanceof Body) {\n      this._stream = bodyInit._stream;\n      this._contentType = bodyInit.headers.get('Content-Type');\n    } else if (bodyInit instanceof Stream.Readable) {\n      // Request + Replay start streaming immediately, so we need this trick to\n      // buffer HTTP responses; this is likely a bug in Replay\n      this._stream = new Stream.PassThrough();\n      this._stream.pause();\n      bodyInit.pipe(this._stream);\n    } else if (typeof bodyInit === 'string' || bodyInit instanceof String) {\n      this._stream = new Stream.Readable();\n      this._stream._read = function() {\n        this.push(bodyInit);\n        this.push(null);\n      };\n      this._contentType = 'text/plain;charset=UTF-8';\n    } else if (bodyInit instanceof FormData && bodyInit.length) {\n      const boundary = `${new Date().getTime()}.${Math.random()}`;\n      this._contentType = `multipart/form-data;boundary=${boundary}`;\n      this._stream   = bodyInit._asStream(boundary);\n    } else if (bodyInit instanceof FormData)\n      this._contentType = 'text/plain;charset=UTF-8';\n    else if (bodyInit)\n      throw new TypeError('This body type not yet supported');\n\n    this._bodyUsed  = false;\n    this.body       = null;\n  }\n\n  get bodyUsed() {\n    return this._bodyUsed;\n  }\n\n  arrayBuffer() {\n    return this\n      ._consume()\n      .then((buffer)=> {\n        this.body = buffer;\n      })\n      .then(()=> {\n        const arrayBuffer = new Uint8Array(this.body.length);\n        for (let i = 0; i < this.body.length; ++i)\n          arrayBuffer[i] = this.body[i];\n        return arrayBuffer;\n      });\n  }\n\n  blob() {\n    throw new Error('Not implemented yet');\n  }\n\n  formData() {\n    return this\n      ._consume()\n      .then((buffer)=> {\n        this.body = buffer;\n      })\n      .then(()=> {\n\n        const contentType = this.headers.get('Content-Type') || '';\n        const mimeType    = contentType.split(';')[0];\n        switch (mimeType) {\n          case 'multipart/form-data': {\n            throw new Error('Not implemented yet');\n          }\n          case 'application/x-www-form-urlencoded': {\n            throw new Error('Not implemented yet');\n          }\n          default: {\n            throw new TypeError(`formData does not support MIME type ${mimeType}`);\n          }\n        }\n\n      });\n  }\n\n  json() {\n    return this\n      ._consume()\n      .then((buffer)=> {\n        this.body = buffer.toString('utf-8');\n      })\n      .then(()=> {\n        return JSON.parse(this.body);\n      });\n  }\n\n  text() {\n    return this\n      ._consume()\n      .then((buffer)=> {\n        this.body = buffer.toString();\n      })\n      .then(()=> {\n        return this.body;\n      });\n  }\n\n\n  // -- Implementation details --\n\n  _consume() {\n    if (this._bodyUsed)\n      throw new TypeError('Body already consumed');\n    this._bodyUsed = true;\n\n    // When Request has no body, _stream is typically null\n    if (!this._stream)\n      return null;\n    // When Response has no body, we get stream that's no longer readable\n    if (!this._stream.readable)\n      return new Buffer('');\n\n    const decompressed = decompressStream(this._stream, this.headers);\n\n    return new Promise(function(resolve, reject) {\n      const buffers = [];\n      decompressed\n        .on('data', function(buffer) {\n          buffers.push(buffer);\n        })\n        .on('end', function() {\n          resolve(Buffer.concat(buffers));\n        })\n        .on('error', reject)\n        .resume();\n    });\n  }\n\n}\n\n\n// https://fetch.spec.whatwg.org/#request-class\nclass Request extends Body {\n\n  constructor(input, init) {\n    const method = ((init ? init.method : input.method) || 'GET').toUpperCase();\n    let bodyInit = null;\n\n    if (input instanceof Request && input._stream) {\n      if (input._bodyUsed)\n        throw new TypeError('Request body already used');\n      bodyInit        = input;\n      input._bodyUsed = true;\n    }\n\n    if (init && init.body) {\n      if (method === 'GET' || method === 'HEAD')\n        throw new TypeError('Cannot include body with GET/HEAD request');\n      bodyInit = init.body;\n    }\n    super(bodyInit);\n\n    if (typeof input === 'string' || input instanceof String)\n      this.url = URL.format(input);\n    else if (input instanceof Request)\n      this.url = input.url;\n    if (!this.url)\n      throw new TypeError('Input must be string or another Request');\n\n    this.method   = method;\n    this.headers  = new Headers(init ? init.headers : input.headers);\n    if (this._contentType && !this.headers.has('Content-Type'))\n      this.headers.set('Content-Type', this._contentType);\n\n    // Default redirect is follow, also treat manual as follow\n    this.redirect = init && init.redirect;\n    if (this.redirect !== 'error')\n      this.redirect = 'follow';\n    this._redirectCount = 0;\n  }\n\n  // -- From Request interface --\n\n  clone() {\n    if (this._bodyUsed)\n      throw new TypeError('This Request body has already been used');\n    throw new Error('Not implemented yet');\n  }\n\n\n  // -- From Body interface --\n\n}\n\n\n// https://fetch.spec.whatwg.org/#response-class\nclass Response extends Body {\n\n  constructor(bodyInit, responseInit) {\n    super(bodyInit);\n    if (responseInit) {\n      if (responseInit.status < 200 || responseInit.status > 599)\n        throw new RangeError(`Status code ${responseInit.status} not in range`);\n      const statusText = responseInit.statusText || HTTP.STATUS_CODES[responseInit.status] || 'Unknown';\n      if (!/^[^\\n\\r]+$/.test(statusText))\n        throw new TypeError(`Status text ${responseInit.statusText} not valid format`);\n\n      this._url       = URL.format(responseInit.url || '');\n      this.type       = 'default';\n      this.status     = responseInit.status;\n      this.statusText = statusText;\n      this.headers    = new Headers(responseInit.headers);\n    } else {\n      this.type       = 'error';\n      this.status     = 0;\n      this.statusText = '';\n      this.headers    = new Headers();\n    }\n    if (this._contentType && !this.headers.has('Content-Type'))\n      this.headers.set('Content-Type', this._contentType);\n  }\n\n  get url() {\n    return (this._url || '').split('#')[0];\n  }\n\n  get ok() {\n    return (this.status >= 200 && this.status <= 299);\n  }\n\n  clone() {\n    if (this._bodyUsed)\n      throw new TypeError('This Response body has already been used');\n    throw new Error('Not implemented yet');\n  }\n\n  static error() {\n    return new Response();\n  }\n\n  static redirect(url, status = 302) {\n    const parsedURL = URL.parse(url);\n    if ([301, 302, 303, 307, 308].indexOf(status) < 0)\n      throw new RangeError(`Status code ${status} not valid redirect code`);\n    const statusText = HTTP.STATUS_CODES[status];\n    const response = new Response(null, { status, statusText });\n    response.headers.set('Location', URL.format(parsedURL));\n    return response;\n  }\n}\n\n\nmodule.exports = {\n  Headers,\n  FormData,\n  Request,\n  Response\n};\n"]}